---
title: "benchmark"
date: "1/7/2018"
output: github_document
---

```{r dbsetup}
library("dplyr")
library("microbenchmark")
```


```{r data}
dL <- data.frame(
  subjectID = c(1,                   
                1,
                2,                   
                2),
  assessmentTotal = c(5,                 
                      2,
                      3,                  
                      4),
  stringsAsFactors = FALSE)
```


```{query}
scale <- 0.237

# this is a function, 
# so body not evaluated until used
dplyr_pipeline <- . %>%
  group_by(subjectID) %>%
    mutate(probability =
             exp(assessmentTotal * scale)/
             sum(exp(assessmentTotal * scale)))
  
dplyr_local <- function() {
  dL %>% dplyr_pipeline
}

```

```{r timings}
# failing in knitr, but not when run in console
tm <- microbenchmark(
  dplyr_local() 
  )
print(tm)
```


